<div class="container">
    <header class="toolbar">
        <h1>Tax Records</h1>


        <div class="actions">
            <input type="text" placeholder="Search..." [(ngModel)]="search" (input)="load()"/>
            <button (click)="load()">Refresh</button>
            <button class="primary" (click)="gotoNew()">New Tax Record</button>

            <div class="sort-controls" style="display: flex; gap: 0.5rem; align-items: center;">
                <button (click)="sortAsc = !sortAsc; records = sortLocal(records.slice())">
                    {{ sortAsc ? 'Ascending' : 'Descending' }}
                </button>

                <label for="sortKey">Sort by:</label>
                <select id="sortKey" [(ngModel)]="sortKey" (change)="records = sortLocal(records.slice())">
                    <option value="taxYear">Tax Year</option>
                    <option value="incomeAmount">Income Amount</option>
                </select>   
            </div>
        </div>
    </header>

    <table *ngIf="records.length; else emptyState">
        <thead>
            <tr>
                <th (click)="setSort('taxYear')">Tax Year</th>
                <th (click)="setSort('recordTitle')">Title</th>
                <th (click)="setSort('incomeAmount')">Income</th>
                <th (click)="setSort('deductionsAmount')">Deductions</th>
                <th (click)="setSort('netIncome')">Net Income</th>
                <th>Notes</th>
                <th>Actions</th>
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let record of records">
                <td><a (click)="gotoEdit(record.id)">{{ record.recordTitle }}</a></td>
                <td>{{ record.taxYear }}</td>
                <td>{{ record.incomeAmount | currency}}</td>
                <td>{{ record.deductionsAmount | currency }}</td>
                <td>{{ record.netIncome | currency }}</td>
                <td>{{ record.notes }}</td>
                <td style="display: flex; gap: 0.5rem;">
                    <button (click)="gotoEdit(record.id)">Edit</button>
                    <button class="danger" (click)="confirmDelete(record.id)">Delete</button>
                </td>
            </tr>
        </tbody>
    </table>

    <ng-template #emptyState>
        <p *ngIf="!loading">No tax records found.</p>
        <p *ngIf="loading">Loading...</p>
    </ng-template>
</div>
